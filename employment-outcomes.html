<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Employment Outcomes for Recent Graduates | Law School Outcomes</title>

    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
  </head>
  <body>
    <h1><a href="index.html">Law School Outcomes</a></h1>
    <h2>Employment Outcomes for Recent Graduates</h2>

    <div id="my-container">
    </div>

    <footer>
      <p>
        <a href="https://data-creative.github.io/law-school-outcomes-dataviz/">view</a> |
        <a href="https://github.com/data-creative/law-school-outcomes-dataviz/">source</a> |
        <a href="https://raw.githubusercontent.com/data-creative/law-school-outcomes-dataviz/master/data/2015/employment_summary_reports.json">data</a>
      </p>
    </footer>

    <script src="http://d3js.org/colorbrewer.v1.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!-- CUSTOM CLASSES BELOW DEPEND ON, AND MUST BE LOADED AFTER, THE D3 LIBRARY -->
    <script type="text/javascript" src="assets/js/employment_summary_report.js"></script>
    <script type="text/javascript" src="assets/js/employment_summary_chart.js"></script>
    <script type="text/javascript">

      function updateChart() {

        var year = 2015
        var url = `data/${year}/employment_summary_reports.json`

        d3.json(url, function(json){

          var reports = json.map(function(rpt){ return new EmploymentSummaryReport(rpt) })

          var sortedReports = reports.sort(function(a, b){ return d3.ascending(a.schoolShortName, b.schoolShortName ) })

          var chart = new EmploymentSummaryChart(sortedReports)

          var employmentTypeGroupings = [
            {group: 'Employed (Other)', color: colorbrewer.Greys[9][6], types: ["Education", "Employer Type Unknown"] },
            {group: 'Public Interest', color: colorbrewer.Oranges[9][4], types: ["Pub. Int."] },
            {group: 'Government', color: colorbrewer.Oranges[9][6], types: ["Government"] },
            {group: 'Clerkship', color: colorbrewer.Purples[9][6], types: ["Clerkships - Federal", "Clerkships - State & Local", "Clerkships - Other"] },
            {group: 'Business & Industry', color: colorbrewer.Blues[9][6], types: ["Business & Industry"] },
            {group: 'Law Firm (Other)', color: colorbrewer.Greens[9][4], types: ["Law Firms (Unknown Size)", "Law Firms (Solo)", "Law Firms (2 - 10)", "Law Firms (11 - 25)", "Law Firms (26 - 50)", "Law Firms (51 - 100)"] },
            {group: 'Law Firm (Big)', color: colorbrewer.Greens[9][6], types: ["Law Firms (101 - 250)", "Law Firms (251 - 500)", "Law Firms (501 +)"] }
          ]





          // Returns a sorted series of numbers, each representing the sum of counts for all employment types belonging to the given display group.
          // @param [String] displayGroup e.g. "Law Firm (Big)"
          function sortedEmploymentTypeSeries(displayGroup) {
            var grouping = employmentTypeGroupings.find(function(grouping){ return grouping.group == displayGroup})

            var employmentTypes = grouping.types // employmentTypeGroups.filter(function(typeGroup){ return typeGroup.defaultDisplayGroup == displayGroup }).map(function(typeGroup){ return typeGroup.type })
            return sortedReports.map(function(report){ return report.sumOfTypeCounts(employmentTypes) })
          }










          function chartSeries(reports, typeGroupings) {
            var series = []

            const sortedUnemployedStatusSeries = reports.map(function(rpt){
              return rpt.sumOfStatusCounts(EmploymentSummaryReport.unemployedStatuses())
            })

            series = series.concat({
              name: 'Unemployed',
              color: colorbrewer.Reds[9][6],
              data: sortedUnemployedStatusSeries // [5, 3, 4, 7, 2] // must be in same order as ['School A', 'School B', 'School C', 'School D', 'School E']
            })

            typeGroupings.forEach(function(grouping){
              series = series.concat({
                name: grouping.group,
                color: grouping.color,
                data: sortedEmploymentTypeSeries(grouping.group) // [5, 3, 4, 7, 2] // must be in same order as ['School A', 'School B', 'School C', 'School D', 'School E']
              })
            })

            return series
          }








































          // COMPILE CHART CONFIGURATION:

          function totalGrads(schoolShortName) {
            return EmploymentSummaryReport.findByShortName(sortedReports, schoolShortName).totalGrads;
          }

          function customTooltip(point) {
            var tooltip = ''
            var headerFormat = `<b>${point.x.toUpperCase()}</b><br/>`
            headerFormat += `<b>Total Grads: ${totalGrads(point.x)}</b><br/>`
            tooltip += headerFormat

            point.points.forEach(function(pt){
              var pointFormat = `<span style="color:${pt.series.color}">${pt.series.name}</span>: <b>${pt.y}</b> (${  Highcharts.numberFormat(pt.percentage, 0)  }%)<br/>`
              tooltip += pointFormat
            })

            return tooltip
          }

          var chartOptions = {
            chart: {
              type: 'column',
              marginBottom:50 // make room to display the subtitle below the chart.
            },
            exporting:{
              enabled:false,
              buttons: {contextButton: {text: 'Export'}}
            },
            credits: {enabled: false},
            legend:{
              align:'right',
              layout:'vertical',
              verticalAlign:'middle'
            },
            title: {text: 'Employment Outcomes by Law School'},
            subtitle: {
              text: 'Copyright 2017 Data Creative (http://data-creative.info). Does not distinguish between short-term/long-term or full-time/part-time employment. Law firm size considered "Big" if greater than or equal to 100 employees.',
              align:'left',
              verticalAlign:'bottom',
              floating:true,
              y: -5,
              style: { "font-size":10, "font-style":"italic" }
            },
            xAxis: {
              categories: chart.categories,
              type: "category",
              opposite:true,
              labels:{
                //formatter:function(){
                //  return `<b>${this.value}</b>`
                //},
                style: { "color": "#000", "cursor": "default", "fontSize": "11px" }
              }
            },
            yAxis: {
              min: 0,
              title: {
                text: `PERCENTAGE OF ${year} GRADUATES`,
                style: { "color": "#000", "cursor": "default", "fontSize": "11px" }
              },
              stackLabels: {enabled: true},
              labels:{
                enabled:true,
                format: '{value}%',
                style: { "color": "#000", "cursor": "default", "fontSize": "11px" }
              }
            },
            tooltip: {
              //headerFormat: '<b>{point.x}</b><br/>', // '<b>{point.key}</b><br/>'
              //pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.percentage:.0f}%)<br/>',
              formatter: function(){ return customTooltip(this) },
              shared: true,
              borderColor: '#000',
              followPointer:true,
              backgroundColor:'rgba(255,255,255, 1)' // use white background and remove opacity
            },
            plotOptions: {
              column: {
                stacking: 'percent',
                dataLabels: {
                  enabled: true,
                  format: '{point.percentage:.0f}%', // '{point.y} ({point.percentage:.0f}%)',
                  color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white'
                },
                events: {legendItemClick: function () { return false; } } // disable data-filtering functionality when series in legend is clicked
              }
            },
            series: chartSeries(sortedReports, employmentTypeGroupings)
          }

          Highcharts.chart('my-container', chartOptions)

        }) // d3.json()

      } // updateChart()

      updateChart()

    </script>
  </body>
</html>
