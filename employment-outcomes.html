<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>Employment Outcomes by School | Law School Outcomes</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/employment_outcomes/chart_controller.css">

    <script src="http://code.highcharts.com/highcharts.js"></script>
    <!--script src="http://code.highcharts.com/modules/exporting.js"></script-->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <h1><a href="index.html">Law School Outcomes</a></h1>
      <h2 style="display:none;">Employment Outcomes by School</h2>

      <div id="chart-container"></div>

      <div id="chart-controller">
        <h3>Chart Options</h3>

        <h4>Year</h4>
        <select id="year-selector"><option value="2015" selected>2015</option></select>

        <h4>Schools</h4>
        <div id="school-checkbox-container"></div>

        <h4>Employment Outcome Groups</h4>
        <button type="button" id="submit-groupings">Submit groupings</button>
        <button type="button" id="restore-default-groupings">Restore default groupings</button>
        <div id="outcome-groups-container">
          <div id="outcome-group-a" class="outcome-group">
            <label for="outcome-group-a-name">Group Name:
              <input type="text" id="outcome-group-a-name" name="group-name" value="Group A (Biz)">
            </label><br>

            <label for="outcome-group-a-color">Group Color:
              <input type="text" id="outcome-group-a-color" name="group-color" value="blue">
            </label><br>

            <label for="outcomes-list-a">Employment Outcomes:</label>
            <ul id="outcomes-list-a" class="outcomes-list" ondrop="drop(event, this)" ondragover="allowDrop(event)">
              <li id="outcome-1" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Law Firms (Solo)">Law Firms (Solo)</li>
              <li id="outcome-2" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Law Firms (2 - 10)">Law Firms (2 - 10)</li>
              <li id="outcome-3" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Law Firms (11 - 25)">Law Firms (11 - 25)</li>
              <li id="outcome-4" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Law Firms (26 - 50)">Law Firms (26 - 50)</li>
              <li id="outcome-5" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Law Firms (51 - 100)">Law Firms (51 - 100)</li>
              <li id="outcome-6" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Law Firms (101 - 250)">Law Firms (101 - 250)</li>
              <li id="outcome-7" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="LLaw Firms (251 - 500)">Law Firms (251 - 500)</li>
              <li id="outcome-8" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Law Firms (501 +)">Law Firms (501 +)</li>
              <li id="outcome-9" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Law Firms (Unknown Size)">Law Firms (Unknown Size)</li>
              <li id="outcome-10" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Business & Industry">Business &amp; Industry</li>
              <li id="outcome-11" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Employer Type Unknown">Employer Type Unknown</li>
              <li id="outcome-12" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Education">Education</li>
            </ul>
          </div>



          <div id="outcome-group-b" class="outcome-group">
            <label for="outcome-group-b-name">Group Name:
              <input type="text" id="outcome-group-b-name" name="group-name" value="Group B (Pub/Gov)">
            </label>
            <br>

            <label for="outcome-group-b-color">Group Color:
              <input type="text" id="outcome-group-b-color" name="group-color" value="orange">
            </label>
            <br>

            <label for="outcomes-list-b">Employment Outcomes:</label>
            <ul id="outcomes-list-b" class="outcomes-list" ondrop="drop(event, this)" ondragover="allowDrop(event)">
              <li id="outcome-13" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Government">Government</li>
              <li id="outcome-14" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Pub. Int.">Pub. Int.</li>
              <li id="outcome-15" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Clerkships - Federal">Clerkships - Federal</li>
              <li id="outcome-16" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Clerkships - State & Local">Clerkships - State &amp; Local</li>
              <li id="outcome-17" class="employment-outcome" draggable="true" ondragstart="drag(event)" data-employment-outcome="Clerkships - Other">Clerkships - Other</li>
            </ul>
          </div>

        </div>
      </div>

      <footer>
        <p>
          <a href="https://data-creative.github.io/law-school-outcomes-dataviz/">view</a> |
          <a href="https://github.com/data-creative/law-school-outcomes-dataviz/">source</a> |
          <a href="https://raw.githubusercontent.com/data-creative/law-school-outcomes-dataviz/master/data/2015/employment_summary_reports.json">data</a>
        </p>
      </footer>
    </div>

    <!--script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script-->
    <script src="http://d3js.org/colorbrewer.v1.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!-- PLEASE DON'T MESS WITH THE ORDER OF SCRIPTS BELOW THIS LINE -->
    <script type="text/javascript" src="assets/js/employment_outcomes/report.js"></script>
    <script type="text/javascript" src="assets/js/employment_outcomes/stacked_100_pct_chart.js"></script>
    <script type="text/javascript">

    //
    // ALLOW FOR DRAGGING AND DROPPING OF EMPLOYMENT OUTCOMES BETWEEN VARIOUS DISPLAY GROUPS
    //

    function drag(ev) {
      ev.dataTransfer.setData("id", ev.target.id) // store draggable element identifier as key/value pair
    }

    function allowDrop(ev) {
      ev.preventDefault()
    }

    function drop(ev, el) {
      ev.preventDefault()
      var id = ev.dataTransfer.getData("id") // fetch draggable element identifier from key/value pair
      el.appendChild(document.getElementById(id))
    }
















      //
      // POPULATE DEFAULT DISPLAY GROUPS
      //
      // const employmentTypes = [
      //   "Law Firms (Solo)",
      //   "Law Firms (2 - 10)",
      //   "Law Firms (11 - 25)",
      //   "Law Firms (26 - 50)",
      //   "Law Firms (51 - 100)",
      //   "Law Firms (101 - 250)",
      //   "Law Firms (251 - 500)",
      //   "Law Firms (501 +)",
      //   "Law Firms (Unknown Size)",
      //   "Business & Industry",
      //   "Government",
      //   "Pub. Int.",
      //   "Clerkships - Federal",
      //   "Clerkships - State & Local",
      //   "Clerkships - Other",
      //   "Education",
      //   "Employer Type Unknown"
      // ]

      const defaultDisplayGroups = [
        {group: 'Employed (Other)', color: colorbrewer.Greys[9][6], types: ["Education", "Employer Type Unknown"] },
        {group: 'Public Interest', color: colorbrewer.Oranges[9][4], types: ["Pub. Int."] },
        {group: 'Government', color: colorbrewer.Oranges[9][6], types: ["Government"] },
        {group: 'Clerkship', color: colorbrewer.Purples[9][6], types: ["Clerkships - Federal", "Clerkships - State & Local", "Clerkships - Other"] },
        {group: 'Business & Industry', color: colorbrewer.Blues[9][6], types: ["Business & Industry"] },
        {group: 'Law Firm (Other)', color: colorbrewer.Greens[9][4], types: ["Law Firms (Unknown Size)", "Law Firms (Solo)", "Law Firms (2 - 10)", "Law Firms (11 - 25)", "Law Firms (26 - 50)", "Law Firms (51 - 100)"] },
        {group: 'Law Firm (Big)', color: colorbrewer.Greens[9][6], types: ["Law Firms (101 - 250)", "Law Firms (251 - 500)", "Law Firms (501 +)"] }
      ]
      // todo: populate divs based on these defaults

































      //
      // GIVEN REPORTING YEAR, GET REPORTS
      //

      var yearSelector = document.getElementById("year-selector")

      function getYear() {
        const year = yearSelector.value
        //console.log("SELECTED YEAR:", year)
        return year
      }

      function fetchReports() {
        const year = getYear()
        const url = `data/${year}/employment_summary_reports.json`

        d3.json(url, function(json){
          var reports = json.map(function(rpt){ return new Report(rpt) })
          var sortedReports = reports.sort(function(a, b){ return d3.ascending(a.schoolShortName, b.schoolShortName ) })
          //console.log("FETCHED REPORTS:", sortedReports.length)

          updateCheckboxes(sortedReports)
        })
      }

      yearSelector.addEventListener("change", fetchReports, false)

      //
      // GIVEN REPORTS, UPDATE CHECKBOXES
      //

      var schoolCheckboxContainer = document.getElementById("school-checkbox-container")

      function removeAllChildren(parentNode) {
        while (parentNode.firstChild) {
          parentNode.removeChild(parentNode.firstChild);
        }
      }

      function updateCheckboxes(reports) {

        removeAllChildren(schoolCheckboxContainer)

        schoolCheckboxContainer.reports = reports // store this here for later use!

        reports.map(function(report){
          report.selectedByDefault = (Math.random() > 0.5) // select schools at random :-)
        })

        reports.forEach(function(report){
          const checkboxId = `${report.schoolShortName.toLowerCase()}-school-selector`
          var checkbox = document.createElement("input")
          checkbox.type = "checkbox"
          checkbox.name = "school[]"
          checkbox.id = checkboxId
          checkbox.className = "school-selector"
          checkbox.value = report.schoolShortName
          checkbox.checked = report.selectedByDefault

          var label = document.createElement("label")
          label.setAttribute("for", checkboxId)
          label.appendChild(checkbox)
          label.append(report.schoolShortName)

          schoolCheckboxContainer.appendChild(label)
          schoolCheckboxContainer.appendChild(document.createElement("br"))
        })

        selectReports()
      }

      //
      // GIVEN CHECKBOX SELECTIONS, SELECT REPORTS
      //

      function getSchoolNames() {
        var checkedBoxes = document.querySelectorAll('input[name="school[]"]:checked')
        var selectedSchoolNames = Array.prototype.map.call(checkedBoxes, function(checkbox){
          return checkbox.value
        })
        //console.log("SELECTED SCHOOLS:", selectedSchoolNames)
        return selectedSchoolNames
      }

      function selectReports(){
        const reports = schoolCheckboxContainer.reports // get this from the element because not always able to pass it from updateCheckboxes()

        const selectedSchoolNames = getSchoolNames()

        const selectedReports = reports.filter(function(report){
          return selectedSchoolNames.includes(report.schoolShortName)
        })

        updateChart(selectedReports)
      }

      schoolCheckboxContainer.addEventListener("change", selectReports, false)

      const groupingSubmissionBtn = document.getElementById("submit-groupings")
      groupingSubmissionBtn.addEventListener("click", selectReports, false)

      //
      // GIVEN REPORT SELECTIONS AND OUTCOME GROUPINGS, UPDATE CHART
      //

      function getGroups() {
        const groupDivs = document.getElementsByClassName("outcome-group")

        return Array.prototype.map.call(groupDivs, function(groupDiv){
          const groupName = groupDiv.querySelector('input[name="group-name"]').value
          const groupColor = groupDiv.querySelector('input[name="group-color"]').value
          const listItems = groupDiv.querySelectorAll('li.employment-outcome')
          const groupOutcomes = Array.prototype.map.call(listItems, function(li){ return li.dataset.employmentOutcome })
          //console.log(groupName, groupColor, groupOutcomes)

          return {
            group: groupName,
            color: groupColor, //colorbrewer.Greys[9][6], // groupColor
            types: groupOutcomes // ["Education", "Employer Type Unknown"]
          }
        })
      }

      function updateChart(sortedSelectedReports) {
        const year = getYear()

        const groupings = getGroups()

        var chart = new Stacked100PctChart(year, sortedSelectedReports, groupings)

        chart.updateOnto('chart-container')
      }

      fetchReports()

    </script>
  </body>
</html>
