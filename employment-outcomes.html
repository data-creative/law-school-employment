<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Employment Outcomes for Recent Graduates | Law School Outcomes</title>

    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
  </head>
  <body>
    <h1><a href="index.html">Law School Outcomes</a></h1>
    <h2>Employment Outcomes for Recent Graduates</h2>

    <div id="my-container"></div>

    <div id="chart-options">
      <h3>Chart Options</h3>

      <h4>Year</h4>
      <p>Use the dropdown below to select a reporting year. Right now the scope of this dashboard is restricted to 2015.</p>
      <select id="year-selector">
        <!--option value="2016">2016</option-->
        <option value="2015" selected>2015</option>
        <!--option value="2014">2014</option-->
      </select>

      <h4>Schools</h4>
      <p>Use the checkboxes below to select one or more schools to display in the chart.</p>
      <div id="school-checkbox-container"></div>

      <h4>Employment Outcome Groups</h4>
      <p>Use the drag-and-drop interface below to specify which employment outcomes should be combined together into a single group.</p>




      <div id="employment-outcomes-container" style="height:700px; border: 2px solid #ccc;">

        <ul id="employment-outcomes" style="list-style:none;">
          <li id="employment-outcome-1" class="draggable-employment-outcome" style="width: 250px; margin-top:5px; margin-bottom:5px; border: 1px solid #000;" draggable="true" ondragstart="drag(event)">Outcome 1</li>
          <li id="employment-outcome-2" class="draggable-employment-outcome" style="width: 250px; margin-top:5px; margin-bottom:5px; border: 1px solid #000;" draggable="true" ondragstart="drag(event)">Outcome 2</li>
          <li id="employment-outcome-3" class="draggable-employment-outcome" style="width: 250px; margin-top:5px; margin-bottom:5px; border: 1px solid #000;" draggable="true" ondragstart="drag(event)">Outcome 3</li>
          <li id="employment-outcome-4" class="draggable-employment-outcome" style="width: 250px; margin-top:5px; margin-bottom:5px; border: 1px solid #000;" draggable="true" ondragstart="drag(event)">Outcome 4</li>
          <li id="employment-outcome-5" class="draggable-employment-outcome" style="width: 250px; margin-top:5px; margin-bottom:5px; border: 1px solid #000;" draggable="true" ondragstart="drag(event)">Outcome 5</li>
        </ul>

        <div class="employment-outcome-display-group" style="padding:25px; border: 2px solid #ccc;">
          <label for="group-name">Name: <input type="text" name="group-name"> </label>
          <label for="group-color">Color: <input type="text" name="group-color"> </label>
          <label for="group-types">Employment Outcomes:</label>
          <div class="employment-outcome-dragndrop-container" style="padding:25px; border: 2px solid #ccc;" ondrop="drop(event)" ondragover="allowDrop(event)">

          </div>
        </div>
      </div>



















    </div>

    <footer>
      <p>
        <a href="https://data-creative.github.io/law-school-outcomes-dataviz/">view</a> |
        <a href="https://github.com/data-creative/law-school-outcomes-dataviz/">source</a> |
        <a href="https://raw.githubusercontent.com/data-creative/law-school-outcomes-dataviz/master/data/2015/employment_summary_reports.json">data</a>
      </p>
    </footer>

    <script src="http://d3js.org/colorbrewer.v1.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <!-- PLEASE DON'T MESS WITH THE ORDER OF SCRIPTS BELOW THIS LINE -->
    <script type="text/javascript" src="assets/js/employment_outcomes/report.js"></script>
    <script type="text/javascript" src="assets/js/employment_outcomes/stacked_100_pct_chart.js"></script>
    <script type="text/javascript">




    function drag(e) {
      console.log("DRAG EVENT:", e)
      //debugger
      e.dataTransfer.setData("text", e.target.id) // specifies the data to be dragged
    } // ADAPTED FROM https://www.w3schools.com/html/html5_draganddrop.asp

    function allowDrop(e) {
      e.preventDefault() // enables the element to receive a drop
    } // ADAPTED FROM https://www.w3schools.com/html/html5_draganddrop.asp

    function drop(e) {
      console.log("DROP EVENT:", e)
      //debugger
      e.preventDefault() // disable default drop behavior, which is to open as a new link
      var data = e.dataTransfer.getData("text") // specifies the data to be dropped
      console.log("DATA TO DROP:", data)
      e.target.appendChild(document.getElementById(data))
    } // ADAPTED FROM https://www.w3schools.com/html/html5_draganddrop.asp









      const employmentTypes = [
        "Law Firms (Solo)",
        "Law Firms (2 - 10)",
        "Law Firms (11 - 25)",
        "Law Firms (26 - 50)",
        "Law Firms (51 - 100)",
        "Law Firms (101 - 250)",
        "Law Firms (251 - 500)",
        "Law Firms (501 +)",
        "Law Firms (Unknown Size)",
        "Business & Industry",
        "Government",
        "Pub. Int.",
        "Clerkships - Federal",
        "Clerkships - State & Local",
        "Clerkships - Other",
        "Education",
        "Employer Type Unknown"
      ]

      const defaultDisplayGroups = [
        {group: 'Employed (Other)', color: colorbrewer.Greys[9][6], types: ["Education", "Employer Type Unknown"] },
        {group: 'Public Interest', color: colorbrewer.Oranges[9][4], types: ["Pub. Int."] },
        {group: 'Government', color: colorbrewer.Oranges[9][6], types: ["Government"] },
        {group: 'Clerkship', color: colorbrewer.Purples[9][6], types: ["Clerkships - Federal", "Clerkships - State & Local", "Clerkships - Other"] },
        {group: 'Business & Industry', color: colorbrewer.Blues[9][6], types: ["Business & Industry"] },
        {group: 'Law Firm (Other)', color: colorbrewer.Greens[9][4], types: ["Law Firms (Unknown Size)", "Law Firms (Solo)", "Law Firms (2 - 10)", "Law Firms (11 - 25)", "Law Firms (26 - 50)", "Law Firms (51 - 100)"] },
        {group: 'Law Firm (Big)', color: colorbrewer.Greens[9][6], types: ["Law Firms (101 - 250)", "Law Firms (251 - 500)", "Law Firms (501 +)"] }
      ]

      function getGroups() {
        return defaultDisplayGroups
      }













      //
      // GIVEN YEAR, GET REPORTS
      //

      var yearSelector = document.getElementById("year-selector")

      function getYear() {
        const year = yearSelector.value
        console.log("SELECTED YEAR:", year)
        return year
      }

      function fetchReports() {
        const year = getYear()
        const url = `data/${year}/employment_summary_reports.json`

        d3.json(url, function(json){
          var reports = json.map(function(rpt){ return new Report(rpt) })
          var sortedReports = reports.sort(function(a, b){ return d3.ascending(a.schoolShortName, b.schoolShortName ) })
          console.log("FETCHED REPORTS:", sortedReports.length)

          updateCheckboxes(sortedReports)
        })
      }

      yearSelector.addEventListener("change", fetchReports, false)

      //
      // GIVEN REPORTS, UPDATE CHECKBOXES
      //

      var schoolCheckboxContainer = document.getElementById("school-checkbox-container")

      function removeAllChildren(parentNode) {
        while (parentNode.firstChild) {
          parentNode.removeChild(parentNode.firstChild);
        }
      }

      function updateCheckboxes(reports) {

        removeAllChildren(schoolCheckboxContainer)

        schoolCheckboxContainer.reports = reports // store this here for later use!

        reports.map(function(report){
          report.selectedByDefault = (Math.random() > 0.5) // select schools at random :-)
        })

        reports.forEach(function(report){
          const checkboxId = `${report.schoolShortName.toLowerCase()}-school-selector`
          var checkbox = document.createElement("input")
          checkbox.type = "checkbox"
          checkbox.name = "school[]"
          checkbox.id = checkboxId
          checkbox.className = "school-selector"
          checkbox.value = report.schoolShortName
          checkbox.checked = report.selectedByDefault

          var label = document.createElement("label")
          label.setAttribute("for", checkboxId)
          label.appendChild(checkbox)
          label.append(report.schoolShortName)

          schoolCheckboxContainer.appendChild(label)
          schoolCheckboxContainer.appendChild(document.createElement("br"))
        })

        selectReports()
      }

      //
      // GIVEN CHECKBOX SELECTIONS, SELECT REPORTS
      //

      function getSchoolNames() {
        var checkedBoxes = document.querySelectorAll('input[name="school[]"]:checked')
        var selectedSchoolNames = Array.prototype.map.call(checkedBoxes, function(checkbox){
          return checkbox.value
        })
        console.log("SELECTED SCHOOLS:", selectedSchoolNames)
        return selectedSchoolNames
      }

      function selectReports(){
        const reports = schoolCheckboxContainer.reports // get this from the element because not always able to pass it from updateCheckboxes()

        const selectedSchoolNames = getSchoolNames()

        const selectedReports = reports.filter(function(report){
          return selectedSchoolNames.includes(report.schoolShortName)
        })

        updateChart(selectedReports)
      }

      schoolCheckboxContainer.addEventListener("change", selectReports, false)

      //
      // GIVEN REPORT SELECTIONS, UPDATE CHART
      //

      function updateChart(sortedSelectedReports) {
        const year = getYear()

        const groupings = getGroups()

        var chart = new Stacked100PctChart(year, sortedSelectedReports, groupings)

        chart.updateOnto('my-container')
      }

      fetchReports()

    </script>
  </body>
</html>
